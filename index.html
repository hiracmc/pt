<!DOCTYPE html>
<html>
<head>
  <title>Google</title>
  <link href="./index.css" rel="stylesheet" />
  <link rel="icon" href="assets/favicon.ico">
  <link rel="apple-touch-icon" href="assets/icon.png">
  <script src="https://kit.fontawesome.com/fe8f095141.js" crossorigin="anonymous"></script>
</head>
<body>


<div class="ue">
    <a href="https://hiracmc.github.io/pontube/">
      <img src="assets/YouTube_Logo_2017.png" alt="ホームへ" class = "home">
    </a>
v0.01
  <div id="js-result">
<div class="kensaku">
          <input type="url" id="youtube-url" placeholder="URL" class="kensaku1">

 <button type="submit" onclick="e()" class="kensaku2">探す</button> 

    </div></div>
</div>
  <!--<iframe width="560" height="315" src="https://cloud.google.com" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  -->
  <div id="video-container"></div>
   <!--<div id="video-info">
    <h2>概要</h2>
    <div id="description"></div>
    <h2>チャンネル情報</h2>
    <div id="channel-info"></div>
    <h2>コメント</h2>
    <div id="comments"></div>
  -->
  </div>

</div>

<script>

const API_KEY = 'YOUR_API_KEY';


  const hash = window.location.hash.slice(1);
  if(hash){
const videoId = hash;
   const url = document.getElementById('youtube-url').value;
url.textContent = `http://youtu.be/${videoId}`;
    
    loadVideo(videoId);
    loadVideoInfo(videoId);
    loadComments(videoId);
  }
function e() {
  const url = document.getElementById('youtube-url').value;
  const videoId = extractVideoId(url);
  if (videoId) {
    window.location.href=`https://hiracmc.github.io/pontube/#${videoId}`;

  } else {
    const url = document.getElementById('youtube-url').value;
  const videoId = extractVideoId2(url);
    if(videoId){
      window.location.href=`https://hiracmc.github.io/pontube/#${videoId}`;
      //location.href=`https://scratch.mit.edu`;

    } else {
    alert('有効なURLを入力してください。');
    window.location.href=`https://hiracmc.github.io/pontube/`;
  }}
}
  

function extractVideoId(url) {
  const regExp = /^.*((youtu.be\/)|(v\/)|(\/?\w?\/))([\w\-]{11}).*/;
  const match = url.match(regExp);
  return (match && match[5].length === 11) ? match[5] : null;
}

  function extractVideoId2(url) {
   const regex = /^(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/;
  
  const match = url.match(regex);

    if (match) {
    return match[1];
  } else {
    return null;
  }
}

function loadVideo(videoId) {
  const container = document.getElementById('video-container');
  container.innerHTML = `<iframe width="854" height="480" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
}

function loadVideoInfo(videoId) {
  fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${API_KEY}`)
    .then(response => response.json())
    .then(data => {
      const videoInfo = data.items[0].snippet;
      document.getElementById('description').textContent = videoInfo.description;
      document.getElementById('channel-info').textContent = `チャンネル名: ${videoInfo.channelTitle}`;
    })
    .catch(error => console.error('Error:', error));
}

function loadComments(videoId) {
  fetch(`https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${API_KEY}`)
    .then(response => response.json())
    .then(data => {
      const commentsContainer = document.getElementById('comments');
      commentsContainer.innerHTML = '';
      data.items.forEach(item => {
        const comment = item.snippet.topLevelComment.snippet;
        const commentElement = document.createElement('p');
        commentElement.textContent = `${comment.authorDisplayName}: ${comment.textDisplay}`;
        commentsContainer.appendChild(commentElement);
      });
    })
    .catch(error => console.error('Error:', error));
}
</script>
</body>
</html>
